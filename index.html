<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Th·∫Øp h∆∞∆°ng online</title>
  <style>
    :root{
      --bg1:#0b1020;
      --bg2:#111827;
      --text:#e5e7eb;
      --muted:#9ca3af;
      --btn:#111827cc;
      --stroke:#ffffff22;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      color:var(--text);
      min-height:100vh;
      background:
        radial-gradient(900px 650px at 50% 0%, rgba(251,191,36,.14), transparent 58%),
        radial-gradient(900px 650px at 80% 20%, rgba(239,68,68,.10), transparent 60%),
        linear-gradient(180deg, var(--bg1), var(--bg2));
      overflow:hidden;
    }

    .topbar{
      position:fixed; left:0; right:0; top:0;
      padding:14px 16px;
      display:flex; align-items:center; justify-content:center;
      z-index:50;
      pointer-events:none;
    }
    .title{
      pointer-events:auto;
      display:flex; flex-direction:column; align-items:center; gap:4px;
      padding:10px 14px;
      border-radius:16px;
      background: rgba(0,0,0,.25);
      border: 1px solid var(--stroke);
      backdrop-filter: blur(10px);
    }
    .title h1{
      margin:0; font-size:16px; letter-spacing:.2px;
    }
    .title .sub{
      font-size:12px; color:var(--muted);
    }

    .stage{
      position:relative;
      width:min(720px, 96vw);
      height:min(860px, 92vh);
      margin: 78px auto 0;
      display:flex;
      justify-content:center;
      align-items:flex-start;
    }

    /* layers */
    .layer{ position:absolute; left:50%; transform:translateX(-50%); user-select:none; pointer-events:none; }
    .temple{
      top: 40px;
      width: min(560px, 92vw);
      height:auto;
      z-index: 10;
      filter: drop-shadow(0 18px 40px rgba(0,0,0,.55));
    }
    .buddha{
      top: -10px;
      left: 16%;
      transform: translateX(-50%);
      width: 260px;
      opacity:.95;
      z-index: 6;
      filter: drop-shadow(0 18px 40px rgba(0,0,0,.45));
    }
    .cloud{
      top: 100px;
      left: 54%;
      transform: translateX(-50%);
      width: 520px;
      opacity:.9;
      z-index: 5;
      animation: float 6s ease-in-out infinite;
    }
    @keyframes float{
      0%,100%{ transform:translateX(-50%) translateY(0); }
      50%{ transform:translateX(-50%) translateY(-10px); }
    }

    /* incense burner area */
    .burnerArea{
      position:absolute;
      left:50%;
      transform:translateX(-50%);
      bottom: 40px;
      width: min(520px, 92vw);
      height: 250px;
      z-index: 30;
      pointer-events:none;
    }

    /* sticks container */
    .sticks{
      position:absolute;
      left:50%;
      transform:translateX(-50%);
      bottom: 66px;
      width: 280px;
      height: 180px;
      z-index: 35;
      pointer-events:none;
    }
    .stick{
      position:absolute;
      bottom:0;
      width: 26px;
      height:auto;
      transform-origin: bottom center;
      animation: rise .35s ease-out;
      filter: drop-shadow(0 10px 18px rgba(0,0,0,.45));
    }
    @keyframes rise{
      from{ transform: translateY(30px) scale(.95); opacity:0; }
      to{ transform: translateY(0) scale(1); opacity:1; }
    }

    /* smoke canvas */
    canvas#smoke{
      position:absolute;
      left:50%;
      transform:translateX(-50%);
      bottom: 100px;
      width: min(520px, 92vw);
      height: 320px;
      z-index: 34;
      pointer-events:none;
      opacity:.95;
    }

    /* controls */
    .controls{
      position:fixed;
      left:50%;
      transform:translateX(-50%);
      bottom: 16px;
      display:flex;
      gap:10px;
      z-index: 60;
    }
    .btn{
      cursor:pointer;
      display:flex;
      align-items:center;
      gap:10px;
      padding: 10px 12px;
      border-radius: 16px;
      background: var(--btn);
      border: 1px solid var(--stroke);
      color: var(--text);
      backdrop-filter: blur(10px);
      box-shadow: 0 18px 50px rgba(0,0,0,.35);
      font-weight:700;
    }
    .btn img{ width:18px; height:18px; }
    .btn:active{ transform: translateY(1px); }
    .btn.secondary{ opacity:.9; font-weight:650; }

    /* note */
    .note{
      position:fixed;
      right: 14px;
      bottom: 14px;
      padding:10px 12px;
      border-radius: 16px;
      background: rgba(0,0,0,.22);
      border: 1px solid var(--stroke);
      color: var(--muted);
      font-size:12px;
      z-index: 60;
      max-width: 240px;
      backdrop-filter: blur(10px);
    }
    @media (max-width: 520px){
      .note{ display:none; }
    }
  </style>
</head>

<body>
  <div class="topbar">
    <div class="title">
      <h1>Th·∫Øp h∆∞∆°ng online</h1>
      <div class="sub">B·∫•m ‚ÄúTh·∫Øp h∆∞∆°ng‚Äù ƒë·ªÉ c·∫Øm nhang & kh√≥i bay</div>
    </div>
  </div>

  <div class="stage" id="stage">
    <!-- decorative -->
    <img class="layer buddha" alt="Ph·∫≠t" src="https://bktemple.vercel.app/img_phat-removebg-preview.png">
    <img class="layer cloud" alt="M√¢y" src="https://bktemple.vercel.app/may-removebg-preview.png">

    <!-- main temple -->
    <img class="layer temple" alt="ƒê·ªÅn" src="./temple.png">

    <!-- smoke -->
    <canvas id="smoke"></canvas>

    <!-- incense sticks -->
    <div class="burnerArea">
      <div class="sticks" id="sticks"></div>
    </div>
  </div>

  <div class="controls">
    <button class="btn" id="addIncense">
      <img alt="+" src="https://bktemple.vercel.app/add_icon.png">
      Th·∫Øp h∆∞∆°ng
    </button>
    <button class="btn secondary" id="bow3">üôè L·∫°y 3 l·∫°y</button>
    <button class="btn secondary" id="clear">üßπ D·ªçn b√†n</button>
  </div>

  <div class="note">
    Tip: th·∫Øp t·ªëi ƒëa 9 n√©n.<br/>
    N·∫øu mu·ªën ‚Äúƒë√∫ng style‚Äù h∆°n, m√¨nh s·∫Ω th√™m: hoa/qu·∫£/n·∫øn d·∫°ng ·∫£nh gi·ªëng m·∫´u.
  </div>

<script>
  // ========= Incense logic =========
  const sticksEl = document.getElementById("sticks");
  const MAX = 9;
  let count = 0;

  function randomBetween(a,b){ return a + Math.random()*(b-a); }

  function addStick(){
    if(count >= MAX) return;
    count++;

    const img = document.createElement("img");
    img.src = "https://bktemple.vercel.app/nhang.png";
    img.className = "stick";

    // spread around center
    const center = 140; // sticks width/2
    const offset = (count - 1) * 18 - ((Math.min(count, MAX) - 1) * 18)/2;
    const x = center + offset + randomBetween(-6, 6);
    const rot = randomBetween(-8, 8);

    img.style.left = `${x}px`;
    img.style.transform = `rotate(${rot}deg)`;
    sticksEl.appendChild(img);

    startSmokeBoost();
  }

  function clearAll(){
    sticksEl.innerHTML = "";
    count = 0;
    puffs.length = 0;
  }

  // ========= Bow 3 times (simple) =========
  let bowing = false;
  const stage = document.getElementById("stage");
  async function sleep(ms){ return new Promise(r=>setTimeout(r,ms)); }
  async function bow3(){
    if(bowing) return;
    bowing = true;
    for(let i=0;i<3;i++){
      stage.animate(
        [
          { transform:"translateY(0)" },
          { transform:"translateY(10px)" },
          { transform:"translateY(0)" }
        ],
        { duration: 650, easing:"ease-in-out" }
      );
      await sleep(750);
    }
    bowing = false;
  }

  document.getElementById("addIncense").onclick = addStick;
  document.getElementById("clear").onclick = clearAll;
  document.getElementById("bow3").onclick = bow3;

  // ========= Smoke (canvas) =========
  const canvas = document.getElementById("smoke");
  const ctx = canvas.getContext("2d");
  let W=0, H=0;
  function resize(){
    const r = canvas.getBoundingClientRect();
    W = canvas.width = Math.floor(r.width * devicePixelRatio);
    H = canvas.height = Math.floor(r.height * devicePixelRatio);
  }
  window.addEventListener("resize", resize);

  const puffs = [];
  function addPuff(x, y){
    puffs.push({
      x, y,
      vx: (Math.random()-0.5) * 0.25,
      vy: -(0.40 + Math.random()*0.40),
      a: 0,
      life: 0,
      max: 180 + Math.random()*80,
      r: 12 + Math.random()*18
    });
  }

  let boost = 0;
  function startSmokeBoost(){
    boost = 80; // more smoke right after lighting
  }

  function draw(){
    ctx.clearRect(0,0,W,H);
    ctx.save();
    ctx.globalCompositeOperation = "lighter";

    // generate puffs from "stick tips"
    const baseX = W/2;
    const baseY = H*0.82;
    const sources = Math.max(1, count);

    // regular smoke
    for(let i=0;i<sources;i++){
      if(Math.random() < 0.14){
        const sx = baseX + (i-(sources-1)/2)*18*devicePixelRatio + (Math.random()-0.5)*10*devicePixelRatio;
        const sy = baseY + (Math.random()-0.5)*6*devicePixelRatio;
        addPuff(sx, sy);
      }
    }
    // boosted smoke
    if(boost > 0){
      boost--;
      for(let k=0;k<2;k++){
        const sx = baseX + (Math.random()-0.5)*30*devicePixelRatio;
        const sy = baseY + (Math.random()-0.5)*10*devicePixelRatio;
        addPuff(sx, sy);
      }
    }

    // draw puffs
    for(let i=puffs.length-1;i>=0;i--){
      const p = puffs[i];
      p.life++;
      p.x += p.vx * devicePixelRatio;
      p.y += p.vy * devicePixelRatio;
      p.vx += (Math.random()-0.5) * 0.01;
      p.a = Math.min(0.22, p.life/60 * 0.22) * (1 - p.life/p.max);

      const rr = p.r * devicePixelRatio * (1 + p.life/230);
      const grad = ctx.createRadialGradient(p.x,p.y,0,p.x,p.y,rr);
      grad.addColorStop(0, `rgba(255,255,255,${p.a})`);
      grad.addColorStop(1, `rgba(255,255,255,0)`);
      ctx.fillStyle = grad;
      ctx.beginPath();
      ctx.arc(p.x,p.y,rr,0,Math.PI*2);
      ctx.fill();

      if(p.life > p.max) puffs.splice(i,1);
    }

    ctx.restore();
    requestAnimationFrame(draw);
  }

  resize();
  draw();
</script>
</body>
</html>
